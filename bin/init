#!/usr/bin/env bash
if [ -e /.inited ]; then
  >&2 echo 'KISS core already inited. Skipping'
  exit 1
fi

php=$(which php)
config=$($php --ini | head -n 1)
config=${config##* }

OPTS=''
if [[ -f $config ]]; then
  OPTS='-c '$config
  echo "Found php config â€“ $config"
fi

echo "Preparing env/* dirs"
mkdir -p /src/env/backup /src/env/etc /src/env/log /src/env/run /src/env/tmp /src/env/var

echo "Running Env::init()"
$php $OPTS <<EOF
<?php
  include getenv('KISS_CORE');
  Env::init()
EOF

echo "Touch /.inited"
touch /.inited

echo "Done"

