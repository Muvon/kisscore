#!/usr/bin/env bash
[[ -z "$PROJECT" ]] && echo 'Not in project. Use "kiss PROJECT" first' && exit 1
echo 'Initialization started'

echo '+Configure and compile project'
php-exec 'Env::init()'
echo '...done'

echo '+Reloading services'
sudo $(which nginx) -s reload 2> /dev/null || echo 'Nginx is not running...skipping reload'
sudo pkill -o -USR2 php-fpm 2> /dev/null || echo 'PHP-FPM is not running...skipping reload'
echo '...done'

echo '+Running init-app script'
[[ ! -f $BIN_DIR/init-app ]] && echo "Use $BIN_DIR/init-app executable for custom init"
[[ -x $BIN_DIR/init-app ]] && $BIN_DIR/init-app | xargs -l echo '  '
echo '...done'
